<!DOCTYPE html>
<html>
  <head>
    <title>AR Marker + GLB Model</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.min.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">

      <!-- Marker (deneme.patt dosyasÄ±) -->
      <a-marker type="pattern" url="markers/deneme.patt" id="marker">
        <a-entity id="model"
                  visible="false"
                  gltf-model="models/model.glb"
                  scale="0.5 0.5 0.5"
                  position="0 0 0"
                  rotation="0 0 0">
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const marker = document.querySelector('#marker');
      const model = document.querySelector('#model');

      let lastMatrixWorld = null;
      let modelPlaced = false;

      marker.addEventListener('markerFound', () => {
        console.log('ðŸ“Œ Marker bulundu');
        model.setAttribute('visible', true);

        const markerObject3D = marker.object3D;
        model.object3D.position.copy(markerObject3D.position);
        model.object3D.rotation.copy(markerObject3D.rotation);
        model.object3D.updateMatrixWorld();

        lastMatrixWorld = model.object3D.matrixWorld.clone();
        modelPlaced = true;
      });

      marker.addEventListener('markerLost', () => {
        console.log('ðŸ“Œ Marker kayboldu, modeli yerinde tut');
        if (modelPlaced) {
          model.setAttribute('visible', true);
          model.object3D.matrix.copy(lastMatrixWorld);
          model.object3D.matrix.decompose(model.object3D.position, model.object3D.quaternion, model.object3D.scale);
        }
      });

      AFRAME.registerComponent('keep-model-position', {
        tick: function () {
          if (!marker.object3D.visible && modelPlaced) {
            // Marker kayÄ±psa model sabit kalsÄ±n
          }
        }
      });

      model.setAttribute('keep-model-position', '');
    </script>
  </body>
</html>
